<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MKV Cleaner - Configuration</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />
  </head>
  <body>
    <div class="container config">
      <h1>⚙️ MKV Cleaner - Path Configuration</h1>

      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div
        class="alert alert-{{ 'success' if category == 'success' else 'error' }}"
      >
        {{ message }}
      </div>
      {% endfor %} {% endif %} {% endwith %}

      <form method="POST">
        <div class="config-section">
          <h2>Paths</h2>

          <div class="form-group">
            <label for="mkvmerge_path">MKVToolNix Path:</label>
            <div style="display: flex; gap: 10px; align-items: center">
              <input
                type="text"
                id="mkvmerge_path"
                name="mkvmerge_path"
                value="{{ config.MKVMERGE_PATH }}"
                required
                style="flex: 1"
              />
              <button
                type="button"
                class="btn btn-secondary"
                onclick="openFileBrowser('mkvmerge_path')"
              >
                📁 Set Folder Path
              </button>
              <button
                type="button"
                class="btn btn-secondary"
                onclick="openExplorer('mkvmerge_path')"
              >
                🪟 Open Folder
              </button>
            </div>
            <div class="help-text">
              Path to mkvmerge.exe (usually in C:\Program Files\MKVToolNix\)
            </div>
          </div>

          <div class="form-group">
            <label for="mkv_folder">MKV Source Folder:</label>
            <div style="display: flex; gap: 10px; align-items: center">
              <input
                type="text"
                id="mkv_folder"
                name="mkv_folder"
                value="{{ config.MKV_FOLDER }}"
                required
                style="flex: 1"
              />
              <button
                type="button"
                class="btn btn-secondary"
                onclick="openFileBrowser('mkv_folder')"
              >
                📁 Set Folder Path
              </button>
              <button
                type="button"
                class="btn btn-secondary"
                onclick="openExplorer('mkv_folder')"
              >
                🪟 Open Folder
              </button>
            </div>
            <div class="help-text">
              Folder containing the MKV files to process
            </div>
          </div>

          <div class="form-group">
            <label for="output_info">Output Folder:</label>
            <div
              style="
                padding: 10px;
                background: #e8f4f8;
                border: 1px solid #bee5eb;
                border-radius: 5px;
                color: #0c5460;
              "
            >
              📁 Processed files will be saved to:
              <strong>[MKV Source Folder]/processed/</strong>
            </div>
            <div class="help-text">
              Output folder is automatically created inside the source folder
            </div>
          </div>
        </div>

        <div style="text-align: center; margin-top: 30px">
          <button type="submit" class="btn btn-primary">
            💾 Save Path Configuration
          </button>
          <a href="/" class="btn btn-secondary">❌ Cancel</a>
        </div>
      </form>
    </div>

    <!-- File Browser Modal -->
    <div id="fileBrowserModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>📁 Browse for Folder</h3>
          <button onclick="closeFileBrowser()" class="modal-close">❌</button>
        </div>

        <div class="modal-controls">
          <select id="driveSelector" onchange="changeDrive()">
            <option value="">Loading drives...</option>
          </select>
          <button onclick="goToParentFolder()" class="btn btn-secondary">
            📁 Up
          </button>
          <button onclick="refreshCurrentFolder()" class="btn btn-secondary">
            🔄 Refresh
          </button>
        </div>

        <div style="margin-bottom: 15px">
          <strong>Current Path:</strong> <span id="currentPath"></span>
        </div>

        <div id="folderList" class="folder-list">
          <div>Loading...</div>
        </div>

        <div class="modal-footer">
          <button onclick="selectCurrentFolder()" class="btn btn-primary">
            ✅ Select This Folder
          </button>
          <button onclick="closeFileBrowser()" class="btn btn-secondary">
            ❌ Cancel
          </button>
        </div>
      </div>
    </div>

    <script src="{{ url_for('static', filename='config.js') }}"></script>
  </body>
</html>
