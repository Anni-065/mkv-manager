<!DOCTYPE html>
<!-- This is a Jinja2 template file -->
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MKV Cleaner - Web Interface</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  </head>
  <body data-default-mkv-folder="{{ config.MKV_FOLDER }}">
    <div class="container">
      <h1>üé¨ MKV Cleaner - Web Interface</h1>

      <div class="nav">
        <a href="/config">‚öôÔ∏è Edit Paths</a>
      </div>

      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div
        class="alert alert-{{ 'success' if category == 'success' else 'error' }}"
      >
        {{ message }}
      </div>
      {% endfor %} {% endif %} {% endwith %}

      <div class="section">
        <h2>Current Configuration</h2>
        <div class="config-info">
          <p><strong>Default Destination Folder:</strong> {{ config.MKV_FOLDER }}</p>
          <p>
            <strong>Allowed Audio Languages:</strong> {{
            config.ALLOWED_AUDIO_LANGS | join(', ') }}
          </p>
          <p>
            <strong>Allowed Subtitle Languages:</strong> {{
            config.ALLOWED_SUB_LANGS | join(', ') }}
          </p>
          <p><strong>Default Audio:</strong> {{ config.DEFAULT_AUDIO_LANG }}</p>
          <p>
            <strong>Default Subtitle:</strong> {{ config.DEFAULT_SUBTITLE_LANG
            }}
          </p>
        </div>
      </div>


      <div class="section">
        <h2>Language Settings</h2>
        <form method="POST" action="/update_settings">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 20px;">
            <div>
              <label style="display: block; margin-bottom: 10px; font-weight: bold; color: #34495e;">Allowed Audio Languages:</label>
              <div style="display: flex; flex-direction: column; gap: 8px;">
                {% for lang_code, lang_name in config.AVAILABLE_AUDIO_LANGS.items() %}
                <div style="display: flex; align-items: center; gap: 8px;">
                  <input type="checkbox" id="audio_{{ lang_code }}" name="allowed_audio_langs" value="{{ lang_code }}"
                         {{ 'checked' if lang_code in config.ALLOWED_AUDIO_LANGS else '' }}>
                  <label for="audio_{{ lang_code }}">{{ lang_name }} ({{ lang_code }})</label>
                </div>
                {% endfor %}
              </div>
            </div>
            <div>
              <label style="display: block; margin-bottom: 10px; font-weight: bold; color: #34495e;">Allowed Subtitle Languages:</label>
              <div style="display: flex; flex-direction: column; gap: 8px;">
                {% for lang_code, lang_name in config.AVAILABLE_SUB_LANGS.items() %}
                <div style="display: flex; align-items: center; gap: 8px;">
                  <input type="checkbox" id="sub_{{ lang_code }}" name="allowed_sub_langs" value="{{ lang_code }}"
                         {{ 'checked' if lang_code in config.ALLOWED_SUB_LANGS else '' }}>
                  <label for="sub_{{ lang_code }}">{{ lang_name }} ({{ lang_code }})</label>
                </div>
                {% endfor %}
              </div>
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 20px;">
            <div>
              <label for="default_audio_lang" style="display: block; margin-bottom: 5px; font-weight: bold; color: #34495e;">Default Audio Language:</label>
              <select id="default_audio_lang" name="default_audio_lang" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                {% for lang_code, lang_name in config.AVAILABLE_AUDIO_LANGS.items() %}
                <option value="{{ lang_code }}" {{ 'selected' if config.DEFAULT_AUDIO_LANG == lang_code else '' }}>{{ lang_name }} ({{ lang_code }})</option>
                {% endfor %}
              </select>
            </div>
            
            <div>
              <label for="default_subtitle_lang" style="display: block; margin-bottom: 5px; font-weight: bold; color: #34495e;">Default Subtitle Language:</label>
              <select id="default_subtitle_lang" name="default_subtitle_lang" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                {% for lang_code, lang_name in config.AVAILABLE_SUB_LANGS.items() %}
                <option value="{{ lang_code }}" {{ 'selected' if config.DEFAULT_SUBTITLE_LANG == lang_code else '' }}>{{ lang_name }} ({{ lang_code }})</option>
                {% endfor %}
              </select>
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 20px;">
            <div>
              <label for="original_audio_lang" style="display: block; margin-bottom: 5px; font-weight: bold; color: #34495e;">Original Audio Language:</label>
              <select id="original_audio_lang" name="original_audio_lang" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                {% for lang_code, lang_name in config.AVAILABLE_AUDIO_LANGS.items() %}
                <option value="{{ lang_code }}" {{ 'selected' if config.ORIGINAL_AUDIO_LANG == lang_code else '' }}>{{ lang_name }} ({{ lang_code }})</option>
                {% endfor %}
              </select>
            </div>
            
            <div>
              <label for="original_subtitle_lang" style="display: block; margin-bottom: 5px; font-weight: bold; color: #34495e;">Original Subtitle Language:</label>
              <select id="original_subtitle_lang" name="original_subtitle_lang" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                {% for lang_code, lang_name in config.ALL_CONFIGURED_LANGS.items() %}
                <option value="{{ lang_code }}" {{ 'selected' if config.ORIGINAL_SUBTITLE_LANG == lang_code else '' }}>{{ lang_name }} ({{ lang_code }})</option>
                {% endfor %}
              </select>
            </div>
          </div>
          
          <div style="text-align: center;">
            <button type="submit" class="btn btn-primary">üíæ Save Language Settings</button>
          </div>
        </form>
      </div>

      <div class="section">
        <h2>Subtitle Processing Options</h2>
        <form method="POST" action="/update_settings">
          <div style="margin-bottom: 20px;">
            <label style="display: flex; align-items: center; gap: 10px; font-weight: bold; color: #34495e;">
              <input type="checkbox" id="extract_subtitles" name="extract_subtitles" {{ 'checked' if config.EXTRACT_SUBTITLES else '' }} style="transform: scale(1.2);">
              <span>üîÑ Convert subtitles to SRT format</span>
            </label>
            <p style="margin: 5px 0 0 32px; font-size: 0.9em; color: #7f8c8d;">
              Extract and convert all supported subtitle formats to SRT during processing
            </p>
          </div>
          
          <div style="margin-bottom: 20px;">
            <label style="display: flex; align-items: center; gap: 10px; font-weight: bold; color: #34495e;">
              <input type="checkbox" id="save_extracted_subtitles" name="save_extracted_subtitles" {{ 'checked' if config.SAVE_EXTRACTED_SUBTITLES else '' }} style="transform: scale(1.2);">
              <span>üíæ Save extracted SRT files next to processed MKV</span>
            </label>
            <p style="margin: 5px 0 0 32px; font-size: 0.9em; color: #7f8c8d;">
              Keep converted SRT files in the same directory as the processed MKV file
            </p>
          </div>
          
          <div style="text-align: center;">
            <button type="submit" class="btn btn-primary">üíæ Save Subtitle Settings</button>
          </div>
        </form>
      </div>

      <div class="section">
        <div class="process-files-header">
          <h2>üìÅ Process Files</h2>
        </div>
        
        <!-- Drag & Drop Zone -->
        <div id="dropZone" class="drop-zone">
          <div class="drop-zone-content">
            <div class="drop-zone-icon">üìÅ</div>
            <div class="drop-zone-text">
              <strong>Drag & Drop Files or Folders Here</strong>
              <p>Drop individual .mkv files or entire folders containing videos</p>
              <p>üí° <em>You can also click here to browse and select files manually</em></p>
            </div>
          </div>
          <div id="dropZoneOverlay" class="drop-zone-overlay">
            <div class="drop-zone-overlay-content">
              <div class="drop-zone-overlay-icon">üìÇ</div>
              <div class="drop-zone-overlay-text">Release to add files</div>
            </div>
          </div>
        </div>

        <!-- Alternative File Selection Methods -->
        <div class="file-selection-alternatives">
          <div class="alternative-methods">
            <h3>Alternative File Selection Methods</h3>
            <div class="method-note">
              <strong>üí° For better file path preservation:</strong> 
              <a href="#" onclick="showDesktopGuiInfo()">Use the Desktop GUI version</a> 
              which can process files directly from their original locations.
            </div>
          </div>
        </div>

        <!-- Dropped Files Display -->
        <div id="droppedFilesSection" class="dropped-files-section" style="display: none;">
          <h3>üìã Ready to Process</h3>
          <div id="droppedFilesList" class="dropped-files-list"></div>
          <div class="dropped-files-actions">
            <button type="button" class="btn btn-primary" onclick="processDroppedFiles()">
              ‚ñ∂Ô∏è Start Processing
            </button>
            <button type="button" class="btn btn-secondary" onclick="clearDroppedFiles()">
              üóëÔ∏è Clear All
            </button>
          </div>
        </div>

        <!-- Processing Status -->
        <div id="processing-status-container" style="margin-top: 2rem;">
          <!-- Idle State -->
          <div id="processing-idle" class="processing-idle">
            <div class="processing-idle-content">
              <div class="processing-idle-text">
                <h3>Ready to Process MKV Files</h3>
                <p>Add files above and click "Start Processing" to begin optimizing your videos!</p>
              </div>
            </div>
            <div class="processing-idle-features">
              <div class="processing-idle-feature">
                <span class="feature-icon">üéØ</span>
                <span class="feature-text">Smart language detection</span>
              </div>
              <div class="processing-idle-feature">
                <span class="feature-icon">üîß</span>
                <span class="feature-text">Automatic subtitle handling</span>
              </div>
              <div class="processing-idle-feature">
                <span class="feature-icon">üìÅ</span>
                <span class="feature-text">Batch folder processing</span>
              </div>
            </div>
          </div>

          <!-- Active Processing State -->
          <div id="processing-active" class="processing-active" style="display: none;">
            <button
              id="stop-btn"
              class="btn btn-danger"
              onclick="stopProcessing()"
              style="display: none"
            >
              ‚èπÔ∏è Stop Processing
            </button>

            <div id="progress-container" class="progress-container">
              <div class="progress-bar">
                <div id="progress-fill" class="progress-fill"></div>
              </div>
              <div id="progress-text" class="progress-text">Ready to start...</div>
            </div>

            <div id="log-container" class="log-container">
              <h3>Processing Log</h3>
              <div id="log" class="log"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    {% include 'file_browser_modal.html' %}

    <script src="{{ url_for('static', filename='file_browser_modal.js') }}"></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
  </body>
</html>
